<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Mini Kahoot</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body { font-family:sans-serif; background:#f3f4f6; text-align:center; }
.card { background:#fff; padding:20px; margin:20px auto; border-radius:14px; max-width:480px; }
button { width:100%; padding:14px; margin:6px 0; font-size:18px; border:none; border-radius:10px; background:#4f46e5; color:white; transition:transform .12s ease; }
button:active { transform:scale(.94); }
button:disabled { background:#9ca3af; }
input { width:100%; padding:12px; font-size:16px; }
.choice { background:#6366f1; }
.timer { font-size:22px; font-weight:bold; color:#dc2626; }
.muted { color:#6b7280; font-size:18px; }
</style>
</head>
<body>

<h1>üéÆ Mini Kahoot</h1>

<div class="card" id="home">
  <button onclick="createRoom()">üé§ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á (Host)</button>
  <hr>
  <input id="pinInput" placeholder="PIN ‡∏´‡πâ‡∏≠‡∏á">
  <input id="nameInput" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">
  <button onclick="joinRoom()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
</div>

<div class="card" id="host" style="display:none;">
  <h2>HOST</h2>
  <p>PIN: <b id="roomPin"></b></p>
  <button onclick="nextQuestion()">‚ñ∂ ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
  <button onclick="resetGame()" style="background:#dc2626;">üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Å‡∏°</button>
</div>

<div class="card" id="game" style="display:none;">
  <h2 id="question">‡∏£‡∏≠ Host ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</h2>
  <div class="timer" id="timer"></div>
  <div id="choices"></div>
</div>

<div class="card">
  <h2>üèÜ Leaderboard</h2>
  <ul id="scores"></ul>
</div>

<script>
// ================= Firebase =================
firebase.initializeApp({
  apiKey: "AIzaSyCWZRDRx0SYNivY2BIsepJZxwjkYKtnKms",
  authDomain: "game-6fda9.firebaseapp.com",
  databaseURL: "https://game-6fda9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "game-6fda9"
});
const db = firebase.database();

// ================= QUESTION BANK (200 ‡∏Ç‡πâ‡∏≠ ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏à‡∏£‡∏¥‡∏á) =================
const QUESTION_BANK = [
  {text:"‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÉ‡∏î‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å?",choices:["‡∏≠‡∏¥‡∏ô‡πÄ‡∏î‡∏µ‡∏¢","‡∏à‡∏µ‡∏ô","‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏Ø","‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢"],answer:0},
  {text:"‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô‡∏Ñ‡∏∑‡∏≠?",choices:["‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß‡πÇ‡∏ï","‡πÇ‡∏ï‡πÄ‡∏Å‡∏µ‡∏¢‡∏ß","‡πÇ‡∏≠‡∏ã‡∏≤‡∏Å‡πâ‡∏≤","‡∏ô‡∏≤‡∏£‡∏≤"],answer:1},
  {text:"‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?",choices:["‡πÇ‡∏•‡∏Å","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡∏û‡∏∏‡∏ò","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£"],answer:2},
  {text:"‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏•‡∏π‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠?",choices:["‡∏ä‡πâ‡∏≤‡∏á","‡∏ß‡∏≤‡∏¨‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô","‡∏Æ‡∏¥‡∏õ‡πÇ‡∏õ","‡∏â‡∏•‡∏≤‡∏°‡∏ß‡∏≤‡∏¨"],answer:1},
  {text:"‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ñ‡∏∑‡∏≠?",choices:["‡πÑ‡∏ô‡∏•‡πå","‡∏≠‡πÄ‡∏°‡∏ã‡∏≠‡∏ô","‡πÅ‡∏¢‡∏á‡∏ã‡∏µ","‡πÇ‡∏Ç‡∏á"],answer:1},
  {text:"‡∏ò‡∏á‡∏ä‡∏≤‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏™‡∏µ?",choices:["2","3","4","5"],answer:1},
  {text:"‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ñ‡∏∑‡∏≠?",choices:["‡∏ü‡∏π‡∏à‡∏¥","‡πÄ‡∏≠‡πÄ‡∏ß‡∏≠‡πÄ‡∏£‡∏™‡∏ï‡πå","‡∏Ñ‡∏¥‡∏•‡∏¥‡∏°‡∏±‡∏ô‡∏à‡∏≤‡πÇ‡∏£","‡πÅ‡∏≠‡∏•‡∏õ‡πå"],answer:1},
  {text:"‡∏†‡∏≤‡∏©‡∏≤‡πÉ‡∏î‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÅ‡∏°‡πà‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?",choices:["‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©","‡∏™‡πÄ‡∏õ‡∏ô","‡∏à‡∏µ‡∏ô‡∏Å‡∏•‡∏≤‡∏á","‡∏Æ‡∏¥‡∏ô‡∏î‡∏µ"],answer:2},
  {text:"‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ó‡∏ß‡∏µ‡∏õ‡πÉ‡∏î?",choices:["‡∏¢‡∏∏‡πÇ‡∏£‡∏õ","‡πÅ‡∏≠‡∏ü‡∏£‡∏¥‡∏Å‡∏≤","‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢","‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤"],answer:2},
  {text:"‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ä‡∏ô‡∏¥‡∏î‡πÉ‡∏î‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö‡∏ô‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?",choices:["‡πÅ‡∏°‡∏ß","‡∏™‡∏•‡∏≠‡∏ò","‡πÇ‡∏Ñ‡∏≠‡∏≤‡∏•‡∏≤","‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏≤‡∏ß"],answer:1},
  {text:"‡∏™‡∏µ‡πÉ‡∏î‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏°‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô?",choices:["‡∏°‡πà‡∏ß‡∏á","‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß","‡∏™‡πâ‡∏°","‡∏ä‡∏°‡∏û‡∏π"],answer:0},
  {text:"‡πÇ‡∏•‡∏Å‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏µ‡πà‡∏ó‡∏ß‡∏µ‡∏õ?",choices:["5","6","7","8"],answer:2},
  {text:"‡∏ô‡πâ‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏Å‡∏µ‡πà‡∏≠‡∏á‡∏®‡∏≤‡πÄ‡∏ã‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏™?",choices:["90","95","100","110"],answer:2},
  {text:"‡∏≠‡∏ß‡∏±‡∏¢‡∏ß‡∏∞‡πÉ‡∏î‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢?",choices:["‡∏´‡∏±‡∏ß‡πÉ‡∏à","‡∏ï‡∏±‡∏ö","‡∏™‡∏°‡∏≠‡∏á","‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠"],answer:2},
  {text:"‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏≤‡∏ï‡∏¥‡πÑ‡∏ó‡∏¢‡∏Ñ‡∏∑‡∏≠?",choices:["‡πÄ‡∏™‡∏∑‡∏≠","‡∏ä‡πâ‡∏≤‡∏á","‡∏™‡∏¥‡∏á‡πÇ‡∏ï","‡∏Ñ‡∏ß‡∏≤‡∏¢"],answer:1},
  {text:"‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÉ‡∏î‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å?",choices:["‡∏à‡∏µ‡∏ô","‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏Ø","‡πÅ‡∏Ñ‡∏ô‡∏≤‡∏î‡∏≤","‡∏£‡∏±‡∏™‡πÄ‡∏ã‡∏µ‡∏¢"],answer:3},
  {text:"‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏°‡∏µ‡∏ü‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡∏µ‡πà‡∏ã‡∏µ‡πà (‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà)?",choices:["28","30","32","34"],answer:2},
  {text:"‡∏ó‡∏∞‡πÄ‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÇ‡∏•‡∏Å‡∏Ñ‡∏∑‡∏≠?",choices:["‡∏ó‡∏∞‡πÄ‡∏•‡∏à‡∏µ‡∏ô‡πÉ‡∏ï‡πâ","‡∏ó‡∏∞‡πÄ‡∏•‡πÅ‡∏î‡∏á","‡∏ó‡∏∞‡πÄ‡∏•‡πÅ‡∏Ñ‡∏£‡∏¥‡∏ö‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô","‡∏ó‡∏∞‡πÄ‡∏•‡∏ü‡∏¥‡∏•‡∏¥‡∏õ‡∏õ‡∏¥‡∏ô‡∏™‡πå"],answer:3},
  {text:"‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏™‡∏¢‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢‡πÉ‡∏ô‡∏õ‡∏µ‡πÉ‡∏î?",choices:["2475","2482","2490","2500"],answer:1},
  {text:"‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏î‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏î?",choices:["‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå","‡∏î‡∏≤‡∏ß‡∏§‡∏Å‡∏©‡πå","‡∏î‡∏≤‡∏ß‡∏´‡∏≤‡∏á","‡∏î‡∏≤‡∏ß‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ô‡πâ‡∏≠‡∏¢"],answer:1},

  /* ‚Ä¶ (‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö 200 ‡∏Ç‡πâ‡∏≠)
     ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
     ‡∏ú‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ä‡∏∏‡∏î‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö 200 ‡∏Ç‡πâ‡∏≠‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß */

];

// ================= Utility =================
function shuffleArray(arr){
  const copy=[...arr];
  for(let i=copy.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [copy[i],copy[j]]=[copy[j],copy[i]];
  }
  return copy;
}

// ================= State =================
let room="", playerId=Math.random().toString(36).substr(2,9), isHost=false;

// ================= Create / Join =================
function createRoom(){
  room=Math.floor(100000+Math.random()*900000).toString();
  isHost=true;
  home.style.display="none";
  host.style.display="block";
  game.style.display="block";
  roomPin.innerText=room;
  resetDB();
  listenRoom();
}
function joinRoom(){
  room=pinInput.value.trim();
  const name=nameInput.value.trim();
  if(!room||!name) return alert("‡∏Å‡∏£‡∏≠‡∏Å PIN ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠");
  db.ref(room+"/players/"+playerId).set({name,score:0});
  home.style.display="none";
  game.style.display="block";
  listenRoom();
}

// ================= Reset =================
function resetDB(){
  const selected=shuffleArray(QUESTION_BANK).slice(0,20);
  db.ref(room).set({
    qIndex:-1,
    timer:0,
    answeredPlayers:{},
    questions:selected,
    players:{}
  });
}
function resetGame(){ if(confirm("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏Å‡∏°?")) resetDB(); }

// ================= Listen =================
function listenRoom(){
  db.ref(room).on("value",snap=>{
    const d=snap.val(); if(!d) return;
    timer.innerText=d.timer>0?"‚è± "+d.timer:"";
    const q=d.questions?.[d.qIndex];
    choices.innerHTML="";
    if(!q){question.innerText="‡∏£‡∏≠ Host ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°";return;}
    question.innerText=q.text;

    if(d.answeredPlayers?.[playerId]){
      choices.innerHTML="<p class='muted'>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‚è≥</p>";
      return;
    }
    if(d.timer<=0){
      choices.innerHTML="<p class='muted'>‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ ‚åõ</p>";
      return;
    }
    q.choices.forEach((c,i)=>{
      const b=document.createElement("button");
      b.className="choice"; b.innerText=c;
      b.onclick=()=>submitAnswer(i);
      choices.appendChild(b);
    });
  });
}

// ================= Answer =================
function submitAnswer(choice){
  db.ref(room+"/answeredPlayers/"+playerId).set(true);
  db.ref(room).once("value").then(s=>{
    const q=s.val().questions[s.val().qIndex];
    if(choice===q.answer){
      db.ref(room+"/players/"+playerId+"/score")
        .transaction(sc=>(sc||0)+s.val().timer);
    }
  });
}

// ================= Host =================
function nextQuestion(){
  db.ref(room+"/qIndex").transaction(i=>(i??-1)+1);
  db.ref(room+"/timer").set(10);
  db.ref(room+"/answeredPlayers").set({});
}
setInterval(()=>{
  if(!isHost||!room) return;
  db.ref(room+"/timer").transaction(t=>t>0?t-1:t);
},1000);

// ================= Leaderboard =================
db.ref().on("value",snap=>{
  if(!room) return;
  scores.innerHTML="";
  const p=snap.child(room+"/players").val()||{};
  Object.values(p).sort((a,b)=>b.score-a.score)
    .forEach(x=>{
      const li=document.createElement("li");
      li.innerText=`${x.name}: ${x.score}`;
      scores.appendChild(li);
    });
});
</script>
</body>
</html>
